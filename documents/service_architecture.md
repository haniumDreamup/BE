# BIF-AI 리마인더 서비스 아키텍처

## 1. 서비스 구성도

```
+------------------------+      +---------------------+      +-----------------------+
|                        |      |                     |      |                       |
|  카메라 디바이스       | <--> |  안드로이드 앱      | <--> |  백엔드 서버 (AWS)    |
|  (하드웨어)            |      |  (모바일 인터페이스) |      |  (Spring Boot)        |
|                        |      |                     |      |                       |
+------------------------+      +---------------------+      +-----------------------+
                                                                       |
                                                                       |
                                                                       v
                               +---------------------+      +-----------------------+
                               |                     |      |                       |
                               |  외부 API 서비스    | <--> |  AI 분석 모듈        |
                               |  (지도, 날씨, 119)  |      |  (LLM 기반)          |
                               |                     |      |                       |
                               +---------------------+      +-----------------------+
```

### 1.1 핵심 구성 요소

#### 1.1.1 카메라 디바이스 (하드웨어)
- **목적**: 사용자 주변 환경 캡처 및 기본 센서 데이터 수집
- **주요 구성 요소**:
  - 카메라 모듈: 주변 환경 이미지 캡처
  - 센서 모듈: 자이로스코프, 가속도계 등
  - 마이크: 음성 데이터 수집 (선택적)
  - 통신 모듈: Wi-Fi/블루투스 연결
  - 배터리 및 전원 관리 시스템
  - 상태 표시 시스템: LED, 진동 등

#### 1.1.2 안드로이드 앱 (모바일 인터페이스)
- **목적**: 사용자 인터페이스 제공 및 디바이스-서버 간 중간 매개체 역할
- **주요 구성 요소**:
  - 디바이스 관리 모듈: 연결, 설정, 상태 확인
  - 사용자 인터페이스: BIF 사용자에 최적화된 UI
  - 알림 시스템: 시각적, 청각적, 촉각적 알림
  - 이미지 처리 및 전송 모듈
  - 일정 관리 및 리마인더 시스템
  - 로컬 데이터 저장소

#### 1.1.3 백엔드 서버 (AWS, Spring Boot)
- **목적**: 데이터 처리, API 관리, 비즈니스 로직 실행
- **주요 구성 요소**:
  - API 게이트웨이: 모든 클라이언트 요청 처리
  - 이미지 처리 서비스: 이미지 전처리 및 최적화
  - 사용자 관리 서비스: 인증, 권한 관리
  - 데이터 관리 서비스: 저장, 검색, 동기화
  - 알림 서비스: 알림 생성 및 전송
  - 모니터링 및 로깅 시스템
  - LLM 통합 모듈

#### 1.1.4 AI 분석 모듈
- **목적**: 이미지 및 상황 분석, 인공지능 기반 추천
- **주요 구성 요소**:
  - LLM 연동 시스템: OpenAI API 등
  - 이미지 분석 엔진
  - 상황 인식 알고리즘
  - 프롬프트 관리 시스템
  - 결과 후처리 및 형식화 모듈

#### 1.1.5 외부 API 서비스
- **목적**: 추가 기능 및 정보 제공을 위한 외부 서비스 연동
- **주요 연동 서비스**:
  - 지도 및 내비게이션 API
  - 날씨 정보 API
  - 긴급 서비스(119) 연동 API
  - 대중교통 정보 API

### 1.2 인프라 구성

#### 1.2.1 클라우드 인프라 (AWS)
- **컴퓨팅**: EC2 인스턴스 (백엔드 서버)
- **데이터베이스**: RDS (MySQL)
- **스토리지**: S3 (이미지 및 파일 저장)
- **네트워킹**: VPC, 보안 그룹, 로드 밸런서
- **모니터링**: CloudWatch
- **보안**: IAM, 암호화

#### 1.2.2 데이터 스토리지
- **관계형 데이터베이스**: MySQL (사용자, 일정, 설정 등)
- **객체 스토리지**: S3 (이미지, 음성 데이터)
- **로컬 스토리지**: 모바일 앱 (임시 데이터, 캐시)
- **디바이스 스토리지**: 제한된 로컬 버퍼 (연결 끊김 대비)

## 2. 서비스 흐름도

### 2.1 기본 데이터 흐름

```
+------------------+     +------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |     |                  |
| 1. 이미지 캡처   | --> | 2. 이미지 전송   | --> | 3. 서버 전처리   | --> | 4. LLM 분석     |
| (카메라 디바이스) |     | (디바이스→서버)  |     | (백엔드 서버)    |     | (AI 모듈)       |
|                  |     |                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+     +------------------+
                                                                                    |
                                                                                    v
+------------------+     +------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |     |                  |
| 8. 사용자 대응   | <-- | 7. 알림 표시     | <-- | 6. 앱으로 전송   | <-- | 5. 결과 후처리   |
| (BIF 사용자)     |     | (앱)             |     | (서버→앱)        |     | (백엔드 서버)    |
|                  |     |                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+     +------------------+
```

### 2.2 상세 서비스 흐름

#### 2.2.1 이미지 캡처 및 분석 흐름
1. **이미지 캡처 단계**
   - 디바이스 카메라가 주변 환경 이미지를 정해진 간격(몇 초)으로 캡처
   - 센서 데이터(자이로스코프, 가속도계) 수집
   - 기본적인 이미지 압축 및 포맷 변환

2. **이미지 전송 단계**
   - 캡처된 이미지를 Wi-Fi/블루투스를 통해 모바일 앱으로 전송
   - 앱에서 이미지 품질 확인 및 필요시 추가 압축
   - 앱에서 서버 API 엔드포인트로 이미지 전송
   - 전송 성공/실패 확인 및 피드백

3. **서버 전처리 단계**
   - 서버에서 이미지 수신 및 유효성 검증
   - 이미지 크기 조정, 필터링 등 전처리
   - 메타데이터(시간, 위치, 사용자 컨텍스트) 추가
   - S3에 원본 이미지 저장 (선택적)

4. **LLM 분석 단계**
   - 전처리된 이미지와 맞춤형 프롬프트를 LLM API로 전송
   - LLM이 이미지를 분석하고 상황 인식
   - 사용자 특성과 맥락에 맞는 설명 및 권장사항 생성
   - 분석 결과 서버로 반환

5. **결과 후처리 단계**
   - LLM 응답을 구조화된 형식으로 파싱
   - 사용자 프로필과 특성에 맞게 언어/내용 단순화
   - 필요시 추가 컨텍스트(날씨, 위치) 통합
   - 알림 우선순위 및 유형 결정

6. **앱으로 결과 전송 단계**
   - 구조화된 분석 결과를 JSON 형태로 앱에 전송
   - 전송 상태 확인 및 오류 처리
   - 필요시 푸시 알림 트리거

7. **알림 표시 단계**
   - 앱에서 서버 응답 수신 및 처리
   - 사용자 인터페이스에 알림 표시 (시각, 청각, 촉각)
   - 상황 설명 및 권장 조치 표시
   - 필요시 단계별 안내 제공

8. **사용자 대응 단계**
   - 사용자가 알림 확인
   - 권장 조치 수행 또는 무시
   - 필요시 추가 정보 요청
   - 선택적인 피드백 제공 (후속 개선용)

#### 2.2.2 일정 관리 및 리마인더 흐름

```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
| 1. 일정 등록     | --> | 2. 서버 저장     | --> | 3. 알림 설정     |
| (앱)             |     | (백엔드 서버)    |     | (서버/앱)        |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
                                                          |
                                                          v
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
| 6. 사용자 대응   | <-- | 5. 알림 표시     | <-- | 4. 알림 트리거   |
| (BIF 사용자)     |     | (앱)             |     | (서버→앱)        |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
```

1. **일정 등록 단계**
   - 사용자 또는 보호자가 앱에서 일정 정보 입력
   - 일정 제목, 설명, 날짜/시간, 반복 패턴, 중요도 설정
   - 알림 시간 및 방식 설정

2. **서버 저장 단계**
   - 앱에서 서버 API로 일정 데이터 전송
   - 서버에서 데이터 유효성 검증
   - MySQL 데이터베이스에 일정 정보 저장
   - 성공/실패 응답 반환

3. **알림 설정 단계**
   - 서버에서 알림 스케줄러에 등록
   - 앱에서 로컬 알림 설정 (백업용)
   - 필요시 보호자 알림 설정

4. **알림 트리거 단계**
   - 예정된 시간에 서버에서 알림 트리거
   - 푸시 알림 또는 앱 내 알림 생성
   - 알림 내용 및 우선순위 결정

5. **알림 표시 단계**
   - 앱에서 알림 수신 및 표시
   - 상황에 맞는 시각, 청각, 촉각 알림 방식 사용
   - 필요한 행동 단계별 안내

6. **사용자 대응 단계**
   - 사용자가 알림 확인
   - 일정 완료 표시 또는 연기
   - 필요시 보호자에게 상태 업데이트

#### 2.2.3 비상 상황 감지 및 대응 흐름

```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
| 1. 이상 상황 감지| --> | 2. 데이터 전송   | --> | 3. 서버 분석     |
| (디바이스 센서)  |     | (디바이스→서버)  |     | (백엔드 서버)    |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
                                                          |
                                                          v
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
| 6. 응급 대응     | <-- | 5. 보호자 알림   | <-- | 4. 위험 확인     |
| (응급 서비스)    |     | (앱→보호자)      |     | (앱→사용자)      |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
```

1. **이상 상황 감지 단계**
   - 디바이스 센서(가속도계)가 낙상 감지
   - 심박수 센서가 비정상적인 심박수 감지
   - 이미지 분석을 통한 위험 상황 감지

2. **데이터 전송 단계**
   - 감지된 이상 데이터를 우선순위 높게 서버로 전송
   - 최근 이미지 및 센서 데이터 함께 전송
   - 전송 확인 및 오류시 재시도

3. **서버 분석 단계**
   - 서버에서 데이터 유효성 및 심각성 분석
   - 필요시 LLM을 통한 이미지 기반 상황 분석
   - 위험 수준 평가 및 대응 계획 결정

4. **위험 확인 단계**
   - 사용자 앱에 위험 상황 확인 요청
   - 카운트다운 타이머로 응답 시간 제한
   - 사용자 응답 또는 시간 초과 처리

5. **보호자 알림 단계**
   - 심각한 상황 또는 사용자 무응답 시 보호자에게 알림
   - 상황 정보, 위치, 이미지 등 제공
   - 보호자 확인 및 대응 지시 요청

6. **응급 대응 단계**
   - 보호자 승인 또는 자동 판단에 따라 119 연결
   - 위치, 상황 정보 자동 전송
   - 응급 대응 가이드 표시

## 3. 데이터 플로우 다이어그램

### 3.1 레벨 0 DFD (컨텍스트 다이어그램)

```
                    +----------------+
이미지/센서 데이터  |                | 상황 인식 및 안내
+---------------->  |                | +---------------->
                    |   BIF-AI       |
일정/설정 정보      |   리마인더     | 알림 및 리마인더
+---------------->  |   시스템       | +---------------->
                    |                |
사용자 피드백       |                | 비상 알림
+---------------->  |                | +---------------->
                    +----------------+
                           ^
                           |
                           v
                    +----------------+
                    |                |
                    |   외부 API     |
                    |   서비스       |
                    |                |
                    +----------------+
```

### 3.2 레벨 1 DFD

```
              +----------------+                +----------------+
이미지 데이터  |                | 압축 이미지    |                | 이미지+프롬프트
+----------->  |   카메라       | +----------->  |   백엔드       | +------------->
              |   디바이스     |                |   서버         |
센서 데이터    |   모듈         | 센서 데이터    |                |
+----------->  |                | +----------->  |                |
              +----------------+                +----------------+
                      ^                                 |
                      |                                 v
                      |                         +----------------+
                      |                         |                |
                      |                         |   AI 분석      |
                      |          분석 결과      |   모듈         |
                      |         +--------------+|                |
                      |                         +----------------+
                      |
                      |
              +----------------+                +----------------+
제어 명령      |                |  사용자 정보   |                |
+----------->  |   모바일       | +----------->  |   데이터       |
              |   앱           |                |   저장소       |
알림 및 안내   |   인터페이스   |  저장된 데이터 |                |
+<-----------+ |                | +<-----------+ |                |
              +----------------+                +----------------+
                      ^
                      |
                      v
              +----------------+
사용자 상호작용|                |
+----------->  |   사용자       |
              |   및 보호자    |
피드백 및 안내 |                |
+<-----------+ |                |
              +----------------+
```

## 4. 기술 스택 요약

### 4.1 서버 측 기술
- **프레임워크**: Spring Boot 2.7.x
- **데이터베이스**: MySQL 8.0
- **클라우드 인프라**: AWS (EC2, RDS, S3)
- **API 구조**: RESTful API
- **인증/보안**: Spring Security, JWT (2단계)
- **AI 통합**: OpenAI API 또는 유사 LLM API

### 4.2 클라이언트 측 기술
- **모바일 앱**: Android (Java/Kotlin)
- **UI 프레임워크**: Material Design
- **네트워크 통신**: Retrofit, OkHttp
- **로컬 데이터베이스**: Room
- **이미지 처리**: Android Camera2 API, Glide

### 4.3 디바이스 기술
- **하드웨어 플랫폼**: ARM 기반 저전력 프로세서
- **센서 모듈**: 카메라, 자이로스코프, 가속도계
- **통신 프로토콜**: Wi-Fi, Bluetooth
- **전원 관리**: 저전력 모드, 충전식 배터리

### 4.4 통신 프로토콜
- **디바이스-앱**: Bluetooth/Wi-Fi 직접 통신
- **앱-서버**: HTTPS/RESTful API
- **서버-외부 API**: HTTPS/RESTful API
- **데이터 포맷**: JSON 