package com.bifai.reminder.bifai_backend.service;

import com.bifai.reminder.bifai_backend.dto.guardian.*;
import com.bifai.reminder.bifai_backend.entity.*;
import com.bifai.reminder.bifai_backend.repository.*;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

@Slf4j
@Service
@RequiredArgsConstructor
public class GuardianDashboardService {
  
  private final UserRepository userRepository;
  private final GuardianRepository guardianRepository;
  private final MedicationRepository medicationRepository;
  private final ScheduleRepository scheduleRepository;
  private final LocationHistoryRepository locationHistoryRepository;
  private final ActivityLogRepository activityLogRepository;
  private final DeviceRepository deviceRepository;
  private final EmergencyRepository emergencyRepository;
  
  /**
   * ë³´í˜¸ì ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public GuardianDashboardDto getDashboard(Long guardianId, Long wardId) {
    // ê¶Œí•œ í™•ì¸
    validateGuardianAccess(guardianId, wardId);
    
    User ward = userRepository.findById(wardId)
        .orElseThrow(() -> new IllegalArgumentException("ë³´í˜¸ ëŒ€ìƒìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"));
    
    return GuardianDashboardDto.builder()
        .wardInfo(buildWardInfo(ward))
        .todaySummary(buildTodaySummary(ward))
        .recentActivities(getRecentActivitiesList(ward, 10))
        .alerts(getActiveAlerts(ward))
        .healthSummary(buildHealthSummary(ward))
        .locationSummary(buildLocationSummary(ward))
        .build();
  }
  
  /**
   * ë³´í˜¸ ëŒ€ìƒì ëª©ë¡ ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public List<WardSummaryDto> getWards(Long guardianId) {
    List<Guardian> guardianships = guardianRepository.findByGuardianUserId(guardianId);
    
    return guardianships.stream()
        .map(g -> buildWardSummary(g.getWardUser()))
        .collect(Collectors.toList());
  }
  
  /**
   * ìµœê·¼ í™œë™ ë‚´ì—­ ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public List<ActivityLogDto> getRecentActivities(Long guardianId, Long wardId, int days) {
    validateGuardianAccess(guardianId, wardId);
    
    LocalDateTime since = LocalDateTime.now().minusDays(days);
    List<ActivityLog> logs = activityLogRepository.findByUserIdAndCreatedAtAfter(wardId, since);
    
    return logs.stream()
        .map(this::toActivityLogDto)
        .collect(Collectors.toList());
  }
  
  /**
   * ì•½ë¬¼ ë³µìš© í˜„í™© ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public MedicationStatusDto getMedicationStatus(Long guardianId, Long wardId, LocalDate date) {
    validateGuardianAccess(guardianId, wardId);
    
    List<Medication> medications = medicationRepository.findByUserIdAndDate(wardId, date);
    List<MedicationAdherence> adherences = medicationRepository.findAdherenceByUserIdAndDate(wardId, date);
    
    int taken = (int) adherences.stream().filter(MedicationAdherence::getTaken).count();
    int total = medications.size();
    
    return MedicationStatusDto.builder()
        .date(date)
        .totalMedications(total)
        .takenMedications(taken)
        .missedMedications(total - taken)
        .pendingMedications(0) // TODO: ì‹œê°„ ê¸°ë°˜ ê³„ì‚°
        .adherenceRate(total > 0 ? (taken * 100.0 / total) : 0)
        .medications(buildMedicationDetails(medications, adherences))
        .weeklyTrend(getWeeklyAdherenceTrend(wardId, date))
        .build();
  }
  
  /**
   * í˜„ì¬ ìœ„ì¹˜ ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public LocationInfoDto getCurrentLocation(Long guardianId, Long wardId) {
    validateGuardianAccess(guardianId, wardId);
    
    LocationHistory latest = locationHistoryRepository
        .findTopByUserIdOrderByTimestampDesc(wardId)
        .orElse(null);
    
    if (latest == null) {
      return LocationInfoDto.builder()
          .timestamp(LocalDateTime.now())
          .build();
    }
    
    return LocationInfoDto.builder()
        .latitude(latest.getLatitude())
        .longitude(latest.getLongitude())
        .address(latest.getAddress())
        .placeName(latest.getPlaceName())
        .timestamp(latest.getTimestamp())
        .accuracy(latest.getAccuracy())
        .movementStatus(detectMovementStatus(wardId))
        .safeZone(checkSafeZoneStatus(latest))
        .recentPlaces(getRecentPlaces(wardId, 5))
        .trajectory(getRecentTrajectory(wardId, 2)) // ìµœê·¼ 2ì‹œê°„
        .build();
  }
  
  /**
   * ê±´ê°• ì§€í‘œ ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public HealthMetricsDto getHealthMetrics(Long guardianId, Long wardId, int days) {
    validateGuardianAccess(guardianId, wardId);
    
    LocalDate endDate = LocalDate.now();
    LocalDate startDate = endDate.minusDays(days);
    
    // TODO: ì‹¤ì œ ê±´ê°• ë©”íŠ¸ë¦­ ë°ì´í„° ì¡°íšŒ
    return HealthMetricsDto.builder()
        .periodDays(days)
        .medicationAdherence(calculateAdherenceRate(wardId, startDate, endDate))
        .averageStepCount(5000) // TODO: ì‹¤ì œ ë°ì´í„°
        .averageHeartRate(75) // TODO: ì‹¤ì œ ë°ì´í„°
        .sleepQualityScore(7.5) // TODO: ì‹¤ì œ ë°ì´í„°
        .activityLevel("MODERATE") // TODO: ì‹¤ì œ ê³„ì‚°
        .build();
  }
  
  /**
   * ë©”ì‹œì§€ ì „ì†¡
   */
  @Transactional
  public void sendMessage(Long guardianId, Long wardId, String message, String type) {
    validateGuardianAccess(guardianId, wardId);
    
    // TODO: FCMì„ í†µí•œ ë©”ì‹œì§€ ì „ì†¡
    log.info("ë©”ì‹œì§€ ì „ì†¡ - from: {}, to: {}, type: {}, message: {}", 
        guardianId, wardId, type, message);
    
    // í™œë™ ë¡œê·¸ ê¸°ë¡
    ActivityLog log = ActivityLog.builder()
        .user(userRepository.getReferenceById(wardId))
        .activityType("MESSAGE_RECEIVED")
        .description("ë³´í˜¸ìë¡œë¶€í„° ë©”ì‹œì§€: " + message)
        .build();
    activityLogRepository.save(log);
  }
  
  /**
   * ë¦¬ë§ˆì¸ë” ì„¤ì •
   */
  @Transactional
  public void setReminder(Long guardianId, Long wardId, SetReminderRequest request) {
    validateGuardianAccess(guardianId, wardId);
    
    User user = userRepository.getReferenceById(wardId);
    Schedule schedule = new Schedule(
        user,
        request.getTitle(),
        Schedule.ScheduleType.REMINDER,
        Schedule.RecurrenceType.ONCE,
        request.getScheduledTime().toLocalTime(),
        request.getScheduledTime()
    );
    schedule.setDescription(request.getDescription());
    schedule.setCreatedByType(Schedule.CreatorType.GUARDIAN);
    
    scheduleRepository.save(schedule);
    log.info("ë¦¬ë§ˆì¸ë” ì„¤ì • ì™„ë£Œ - guardian: {}, ward: {}, reminder: {}", 
        guardianId, wardId, request.getTitle());
  }
  
  /**
   * ê¸´ê¸‰ ì—°ë½ì²˜ ì¡°íšŒ
   */
  @Transactional(readOnly = true)
  public List<EmergencyContactDto> getEmergencyContacts(Long guardianId, Long wardId) {
    validateGuardianAccess(guardianId, wardId);
    
    // TODO: ê¸´ê¸‰ ì—°ë½ì²˜ ì—”í‹°í‹°ì—ì„œ ì¡°íšŒ
    List<EmergencyContactDto> contacts = new ArrayList<>();
    
    // ë³´í˜¸ì ì •ë³´ë„ í¬í•¨
    Guardian guardian = guardianRepository.findByGuardianUserIdAndWardUserId(guardianId, wardId)
        .orElse(null);
    
    if (guardian != null) {
      User guardianUser = guardian.getGuardianUser();
      contacts.add(EmergencyContactDto.builder()
          .name(guardianUser.getName())
          .phoneNumber(guardianUser.getPhoneNumber())
          .relationship(guardian.getRelationship())
          .isPrimary(guardian.getIsPrimary())
          .build());
    }
    
    return contacts;
  }
  
  /**
   * ì•ˆë¶€ í™•ì¸ ìš”ì²­
   */
  @Transactional
  public void requestCheckIn(Long guardianId, Long wardId) {
    validateGuardianAccess(guardianId, wardId);
    
    // TODO: í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ ì•ˆë¶€ í™•ì¸ ìš”ì²­ ì „ì†¡
    log.info("ì•ˆë¶€ í™•ì¸ ìš”ì²­ - guardian: {}, ward: {}", guardianId, wardId);
    
    // í™œë™ ë¡œê·¸ ê¸°ë¡
    ActivityLog log = ActivityLog.builder()
        .user(userRepository.getReferenceById(wardId))
        .activityType("CHECK_IN_REQUEST")
        .description("ë³´í˜¸ìê°€ ì•ˆë¶€ í™•ì¸ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤")
        .build();
    activityLogRepository.save(log);
  }
  
  /**
   * ì¼ì¼ ë³´ê³ ì„œ ìƒì„±
   */
  @Transactional(readOnly = true)
  public DailyReportDto getDailyReport(Long guardianId, Long wardId, LocalDate date) {
    validateGuardianAccess(guardianId, wardId);
    
    // TODO: ì‹¤ì œ ë°ì´í„° ì¡°íšŒ êµ¬í˜„
    return DailyReportDto.builder()
        .date(date)
        .completedTasks(10)
        .totalTasks(12)
        .medicationAdherence(0.85)
        .stepCount(5000)
        .summary("ì¼ì¼ í™œë™ ìš”ì•½")
        .build();
  }
  
  /**
   * ì£¼ê°„ ë³´ê³ ì„œ ìƒì„±
   */
  @Transactional(readOnly = true)
  public WeeklyReportDto getWeeklyReport(Long guardianId, Long wardId, LocalDate startDate) {
    validateGuardianAccess(guardianId, wardId);
    
    LocalDate endDate = startDate.plusDays(6);
    
    // TODO: ì‹¤ì œ ë°ì´í„° ì¡°íšŒ êµ¬í˜„
    return WeeklyReportDto.builder()
        .startDate(startDate)
        .endDate(endDate)
        .averageMedicationAdherence(0.90)
        .totalActivities(75)
        .dailyReports(new ArrayList<>())
        .weekSummary("ì£¼ê°„ í™œë™ ìš”ì•½")
        .build();
  }
  
  /**
   * ë³´í˜¸ì ì„¤ì • ì—…ë°ì´íŠ¸
   */
  @Transactional
  public GuardianSettingsDto updateSettings(Long guardianId, GuardianSettingsDto settings) {
    // TODO: ì„¤ì • ì €ì¥ ë¡œì§ êµ¬í˜„
    log.info("ë³´í˜¸ì ì„¤ì • ì—…ë°ì´íŠ¸ - guardian: {}", guardianId);
    return settings;
  }
  
  // === Private Helper Methods ===
  
  private void validateGuardianAccess(Long guardianId, Long wardId) {
    boolean hasAccess = guardianRepository.existsByGuardianUserIdAndWardUserId(guardianId, wardId);
    if (!hasAccess) {
      throw new SecurityException("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤");
    }
  }
  
  private GuardianDashboardDto.WardInfo buildWardInfo(User ward) {
    Device primaryDevice = deviceRepository.findActiveDevicesByUserId(ward.getId())
        .stream().findFirst().orElse(null);
    
    return GuardianDashboardDto.WardInfo.builder()
        .id(ward.getId())
        .name(ward.getName())
        .profileImage(ward.getProfileImage())
        .phoneNumber(ward.getPhoneNumber())
        .age(ward.getAge())
        .status(determineUserStatus(ward))
        .lastActiveAt(ward.getLastActiveAt())
        .batteryLevel(primaryDevice != null ? primaryDevice.getBatteryLevel() : null)
        .build();
  }
  
  private GuardianDashboardDto.TodaySummary buildTodaySummary(User ward) {
    LocalDate today = LocalDate.now();
    
    // ì•½ë¬¼ ë³µìš© í˜„í™©
    List<Medication> todayMeds = medicationRepository.findByUserIdAndDate(ward.getId(), today);
    List<MedicationAdherence> adherences = medicationRepository.findAdherenceByUserIdAndDate(ward.getId(), today);
    int medsTaken = (int) adherences.stream().filter(MedicationAdherence::getTaken).count();
    
    // ì¼ì • ì™„ë£Œ í˜„í™©
    List<Schedule> todaySchedules = scheduleRepository.findByUserIdAndDate(ward.getId(), today);
    int schedulesCompleted = (int) todaySchedules.stream()
        .filter(s -> "COMPLETED".equals(s.getStatus()))
        .count();
    
    // í™œë™ ì ìˆ˜ ê³„ì‚°
    int activityScore = calculateActivityScore(ward.getId(), today);
    
    return GuardianDashboardDto.TodaySummary.builder()
        .medicationsTaken(medsTaken)
        .medicationsTotal(todayMeds.size())
        .schedulesCompleted(schedulesCompleted)
        .schedulesTotal(todaySchedules.size())
        .activityScore(activityScore)
        .overallStatus(determineOverallStatus(activityScore, medsTaken, todayMeds.size()))
        .build();
  }
  
  private List<GuardianDashboardDto.RecentActivity> getRecentActivitiesList(User ward, int limit) {
    List<ActivityLog> logs = activityLogRepository
        .findTopNByUserIdOrderByCreatedAtDesc(ward.getId(), limit);
    
    return logs.stream()
        .map(log -> GuardianDashboardDto.RecentActivity.builder()
            .type(log.getActivityType())
            .title(log.getActivityType())
            .description(log.getDescription())
            .timestamp(log.getCreatedAt())
            .icon(getActivityIcon(log.getActivityType()))
            .status(log.getStatus())
            .build())
        .collect(Collectors.toList());
  }
  
  private List<GuardianDashboardDto.Alert> getActiveAlerts(User ward) {
    // TODO: ì‹¤ì œ ì•Œë¦¼ ë°ì´í„° ì¡°íšŒ
    List<GuardianDashboardDto.Alert> alerts = new ArrayList<>();
    
    // ë°°í„°ë¦¬ ë¶€ì¡± í™•ì¸
    Device device = deviceRepository.findActiveDevicesByUserId(ward.getId())
        .stream().findFirst().orElse(null);
    
    if (device != null && device.getBatteryLevel() != null && device.getBatteryLevel() < 20) {
      alerts.add(GuardianDashboardDto.Alert.builder()
          .level("MEDIUM")
          .type("BATTERY_LOW")
          .message("ë””ë°”ì´ìŠ¤ ë°°í„°ë¦¬ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ (" + device.getBatteryLevel() + "%)")
          .timestamp(LocalDateTime.now())
          .isRead(false)
          .actionRequired("ì¶©ì „ ì•Œë¦¼ ì „ì†¡")
          .build());
    }
    
    return alerts;
  }
  
  private GuardianDashboardDto.HealthSummary buildHealthSummary(User ward) {
    LocalDate today = LocalDate.now();
    LocalDate weekAgo = today.minusDays(7);
    
    double adherence = calculateAdherenceRate(ward.getId(), weekAgo, today);
    
    return GuardianDashboardDto.HealthSummary.builder()
        .medicationAdherence(adherence)
        .stepCount(5000) // TODO: ì‹¤ì œ ë°ì´í„°
        .heartRate(75) // TODO: ì‹¤ì œ ë°ì´í„°
        .sleepQuality("GOOD") // TODO: ì‹¤ì œ ë°ì´í„°
        .lastHealthCheck(LocalDateTime.now())
        .build();
  }
  
  private GuardianDashboardDto.LocationSummary buildLocationSummary(User ward) {
    LocationHistory latest = locationHistoryRepository
        .findTopByUserIdOrderByTimestampDesc(ward.getId())
        .orElse(null);
    
    if (latest == null) {
      return GuardianDashboardDto.LocationSummary.builder()
          .safeZoneStatus("UNKNOWN")
          .lastUpdated(LocalDateTime.now())
          .build();
    }
    
    return GuardianDashboardDto.LocationSummary.builder()
        .latitude(latest.getLatitude())
        .longitude(latest.getLongitude())
        .address(latest.getAddress())
        .safeZoneStatus(checkSafeZoneStatus(latest).getStatus())
        .lastUpdated(latest.getTimestamp())
        .distanceFromHome(calculateDistanceFromHome(latest))
        .build();
  }
  
  private WardSummaryDto buildWardSummary(User ward) {
    LocalDate today = LocalDate.now();
    
    // ì˜¤ëŠ˜ì˜ ì§„í–‰ë¥  ê³„ì‚°
    List<Medication> todayMeds = medicationRepository.findByUserIdAndDate(ward.getId(), today);
    List<MedicationAdherence> adherences = medicationRepository.findAdherenceByUserIdAndDate(ward.getId(), today);
    int medProgress = todayMeds.isEmpty() ? 100 : 
        (int) (adherences.stream().filter(MedicationAdherence::getTaken).count() * 100.0 / todayMeds.size());
    
    List<Schedule> todaySchedules = scheduleRepository.findByUserIdAndDate(ward.getId(), today);
    int scheduleProgress = todaySchedules.isEmpty() ? 100 :
        (int) (todaySchedules.stream().filter(s -> "COMPLETED".equals(s.getStatus())).count() * 100.0 / todaySchedules.size());
    
    // ìµœê·¼ ìœ„ì¹˜
    LocationHistory location = locationHistoryRepository
        .findTopByUserIdOrderByTimestampDesc(ward.getId())
        .orElse(null);
    
    return WardSummaryDto.builder()
        .id(ward.getId())
        .name(ward.getName())
        .profileImage(ward.getProfileImage())
        .phoneNumber(ward.getPhoneNumber())
        .age(ward.getAge())
        .relationship("ê°€ì¡±") // TODO: Guardian ì—”í‹°í‹°ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        .status(determineUserStatus(ward))
        .lastActiveAt(ward.getLastActiveAt())
        .batteryLevel(getLatestBatteryLevel(ward.getId()))
        .hasUnreadAlerts(false) // TODO: ì‹¤ì œ ì•Œë¦¼ í™•ì¸
        .todayMedicationProgress(medProgress)
        .todayScheduleProgress(scheduleProgress)
        .statusMessage(generateStatusMessage(ward))
        .lastKnownLocation(location != null ? location.getAddress() : "ìœ„ì¹˜ ì •ë³´ ì—†ìŒ")
        .emergencyContactAvailable(true)
        .build();
  }
  
  private ActivityLogDto toActivityLogDto(ActivityLog log) {
    return ActivityLogDto.builder()
        .id(log.getId())
        .activityType(log.getActivityType())
        .title(log.getActivityType())
        .description(log.getDescription())
        .timestamp(log.getCreatedAt())
        .status(log.getStatus())
        .category(determineCategory(log.getActivityType()))
        .icon(getActivityIcon(log.getActivityType()))
        .colorCode(getActivityColor(log.getActivityType()))
        .importance(determineImportance(log.getActivityType()))
        .build();
  }
  
  // í—¬í¼ ë©”ì„œë“œë“¤
  private String determineUserStatus(User user) {
    if (user.getLastLoginAt() == null) return "OFFLINE";
    
    long minutesSinceActive = ChronoUnit.MINUTES.between(user.getLastLoginAt(), LocalDateTime.now());
    if (minutesSinceActive < 5) return "ONLINE";
    if (minutesSinceActive < 60) return "IDLE";
    return "OFFLINE";
  }
  
  private String determineOverallStatus(int activityScore, int medsTaken, int medsTotal) {
    if (activityScore >= 80 && (medsTotal == 0 || medsTaken == medsTotal)) {
      return "GOOD";
    } else if (activityScore >= 50 && (medsTotal == 0 || medsTaken >= medsTotal * 0.7)) {
      return "NORMAL";
    }
    return "NEEDS_ATTENTION";
  }
  
  private int calculateActivityScore(Long userId, LocalDate date) {
    // TODO: ì‹¤ì œ í™œë™ ì ìˆ˜ ê³„ì‚° ë¡œì§
    return 75;
  }
  
  private double calculateAdherenceRate(Long userId, LocalDate startDate, LocalDate endDate) {
    // TODO: ì‹¤ì œ ë³µìš©ë¥  ê³„ì‚°
    return 85.0;
  }
  
  private String getActivityIcon(String activityType) {
    switch (activityType) {
      case "MEDICATION_TAKEN": return "ğŸ’Š";
      case "SCHEDULE_COMPLETED": return "âœ…";
      case "LOCATION_CHANGE": return "ğŸ“";
      case "EMERGENCY": return "ğŸš¨";
      default: return "ğŸ“";
    }
  }
  
  private String getActivityColor(String activityType) {
    switch (activityType) {
      case "MEDICATION_TAKEN": return "#4CAF50";
      case "SCHEDULE_COMPLETED": return "#2196F3";
      case "LOCATION_CHANGE": return "#FF9800";
      case "EMERGENCY": return "#F44336";
      default: return "#757575";
    }
  }
  
  private String determineCategory(String activityType) {
    if (activityType.contains("MEDICATION")) return "HEALTH";
    if (activityType.contains("SCHEDULE")) return "DAILY_ROUTINE";
    if (activityType.contains("LOCATION")) return "SAFETY";
    if (activityType.contains("EMERGENCY")) return "SAFETY";
    return "OTHER";
  }
  
  private String determineImportance(String activityType) {
    if (activityType.contains("EMERGENCY")) return "HIGH";
    if (activityType.contains("MEDICATION")) return "HIGH";
    if (activityType.contains("LOCATION")) return "MEDIUM";
    return "LOW";
  }
  
  private Integer getLatestBatteryLevel(Long userId) {
    return deviceRepository.findActiveDevicesByUserId(userId).stream()
        .findFirst()
        .map(Device::getBatteryLevel)
        .orElse(null);
  }
  
  private String generateStatusMessage(User user) {
    // ê°„ë‹¨í•œ ìƒíƒœ ë©”ì‹œì§€ ìƒì„±
    String status = determineUserStatus(user);
    if ("ONLINE".equals(status)) {
      return "í˜„ì¬ í™œë™ ì¤‘";
    } else if ("IDLE".equals(status)) {
      return "ì ì‹œ ì‰¬ëŠ” ì¤‘";
    }
    return "ì˜¤í”„ë¼ì¸";
  }
  
  private List<MedicationStatusDto.MedicationDetail> buildMedicationDetails(
      List<Medication> medications, List<MedicationAdherence> adherences) {
    // TODO: ì‹¤ì œ ë§¤í•‘ ë¡œì§
    return new ArrayList<>();
  }
  
  private List<MedicationStatusDto.DailyAdherence> getWeeklyAdherenceTrend(Long userId, LocalDate date) {
    // TODO: ì£¼ê°„ ë³µìš©ë¥  ì¶”ì´ ê³„ì‚°
    return new ArrayList<>();
  }
  
  private String detectMovementStatus(Long userId) {
    // TODO: ìµœê·¼ ìœ„ì¹˜ ë³€í™”ë¡œ ì´ë™ ìƒíƒœ ê°ì§€
    return "STATIONARY";
  }
  
  private LocationInfoDto.SafeZoneInfo checkSafeZoneStatus(LocationHistory location) {
    // TODO: ì•ˆì „ êµ¬ì—­ í™•ì¸ ë¡œì§
    return LocationInfoDto.SafeZoneInfo.builder()
        .status("INSIDE")
        .zoneName("ì§‘")
        .distanceFromCenter(50.0)
        .radius(500.0)
        .alertEnabled(true)
        .build();
  }
  
  private List<LocationInfoDto.RecentPlace> getRecentPlaces(Long userId, int limit) {
    // TODO: ìµœê·¼ ë°©ë¬¸ ì¥ì†Œ ì¡°íšŒ
    return new ArrayList<>();
  }
  
  private List<LocationInfoDto.LocationPoint> getRecentTrajectory(Long userId, int hours) {
    // TODO: ìµœê·¼ ì´ë™ ê²½ë¡œ ì¡°íšŒ
    return new ArrayList<>();
  }
  
  private Double calculateDistanceFromHome(LocationHistory location) {
    // TODO: ì§‘ìœ¼ë¡œë¶€í„° ê±°ë¦¬ ê³„ì‚°
    return 100.0;
  }
  
  private List<ActivityLogDto> getActivitiesForDate(Long userId, LocalDate date) {
    // TODO: íŠ¹ì • ë‚ ì§œ í™œë™ ì¡°íšŒ
    return new ArrayList<>();
  }
  
  private String getLocationSummaryForDate(Long userId, LocalDate date) {
    // TODO: íŠ¹ì • ë‚ ì§œ ìœ„ì¹˜ ìš”ì•½
    return "ì£¼ë¡œ ì§‘ì—ì„œ í™œë™";
  }
  
  private String generateDailyAssessment(Long userId, LocalDate date) {
    // TODO: ì¼ì¼ í‰ê°€ ìƒì„±
    return "ì „ë°˜ì ìœ¼ë¡œ ì–‘í˜¸í•œ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤";
  }
  
  private int countActivities(Long userId, LocalDate startDate, LocalDate endDate) {
    // TODO: í™œë™ ìˆ˜ ê³„ì‚°
    return 50;
  }
  
  private List<String> getWeeklyHighlights(Long userId, LocalDate startDate, LocalDate endDate) {
    // TODO: ì£¼ê°„ í•˜ì´ë¼ì´íŠ¸
    return List.of("ì•½ë¬¼ ë³µìš©ë¥  95% ë‹¬ì„±", "ëª¨ë“  ì¼ì • ì™„ë£Œ");
  }
  
  private List<String> getWeeklyConcerns(Long userId, LocalDate startDate, LocalDate endDate) {
    // TODO: ì£¼ê°„ ìš°ë ¤ì‚¬í•­
    return List.of("ìˆ˜ìš”ì¼ ì €ë… ì•½ ë³µìš© ì§€ì—°");
  }
  
  private List<String> generateRecommendations(Long userId, LocalDate startDate, LocalDate endDate) {
    // TODO: ê°œì„  ê¶Œì¥ì‚¬í•­
    return List.of("ì €ë… ì•½ ì•Œë¦¼ ì‹œê°„ì„ 30ë¶„ ì•ë‹¹ê¸°ê¸°");
  }
}