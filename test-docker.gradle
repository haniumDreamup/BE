// Docker 환경 테스트 실행 태스크
task testWithDocker(type: Test) {
  useJUnitPlatform()
  
  // Docker 프로파일 사용
  systemProperty 'spring.profiles.active', 'docker-test'
  
  // Docker 환경 변수 설정
  environment 'SPRING_PROFILES_ACTIVE', 'docker-test'
  environment 'SPRING_DATASOURCE_URL', 'jdbc:mysql://localhost:3308/bifai_test_db?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true&characterEncoding=UTF-8&createDatabaseIfNotExist=true'
  environment 'SPRING_DATASOURCE_USERNAME', 'bifai_test'
  environment 'SPRING_DATASOURCE_PASSWORD', 'bifai_test_pass'
  environment 'SPRING_DATA_REDIS_HOST', 'localhost'
  environment 'SPRING_DATA_REDIS_PORT', '6381'
  
  // 테스트 로깅
  testLogging {
    events "passed", "failed", "skipped"
    showStandardStreams = false
    exceptionFormat = 'full'
  }
  
  // 실패한 테스트 계속 실행
  ignoreFailures = true
  
  // 테스트 결과 출력
  afterSuite { desc, result ->
    if (!desc.parent) {
      println "\n테스트 결과:"
      println "실행: ${result.testCount}"
      println "성공: ${result.successfulTestCount}"
      println "실패: ${result.failedTestCount}"
      println "건너뜀: ${result.skippedTestCount}"
    }
  }
}